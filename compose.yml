services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    # image: casino-usm-reservas-dev
    tty: true
    stdin_open: true
    command: sh -c "pnpm install --no-frozen-lockfile && pnpm dev -p 3000 --hostname 0.0.0.0"
    ports:
      - "3000:3000"
    environment:
      # Improve file watching on bind mounts (especially on Windows/macOS)
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
      - NEXT_TELEMETRY_DISABLED=1
      - NODE_ENV=development
      - CI=true
      # Persist pnpm store in a named volume
      - PNPM_STORE_DIR=/pnpm-store
    volumes:
      # Mount source code
      - .:/app
      # Keep node_modules inside the container in a named volume
      - node_modules:/app/node_modules
      # Keep Next.js cache/build output inside the container for faster reloads on Windows
      - next-cache:/app/.next
      # Persist pnpm store cache between runs
      - pnpm-store:/pnpm-store
    # Speeds up hot reloads with bind mounts (requires recent Docker Compose)
    develop:
      watch:
        - action: sync
          path: .
          target: /app
          ignore:
            - node_modules/
            - .next/
            - .git/
volumes:
  node_modules:
  next-cache:
  pnpm-store:
